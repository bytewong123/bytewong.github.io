---
title: 进程和线程
date: 2023-01-08T18:06:57+08:00
draft: false
categories: [""]
tags: [""]
---

# 进程和线程
#技术/操作系统

## 进程的状态有哪些？
### 三态模型
运行、就绪、阻塞/等待
### 五态模型
新建 + 三态模型 + 终止
### 七态模型
五态模型 + 就绪挂起 + 阻塞挂起

- 新建
- 运行
- 就绪
	- 可运行，但因为其他进程正在运行而暂停停止
- 阻塞
	- 该进程正在等待某一事件发生（如等待输入/输出操作的完成）而暂时停止运行，这时，即使给它CPU控制权，它也无法运行
- 就绪挂起（进程具备运行条件，但目前在外存中，只有它被对换到内存才能被调度执行）
- 等待挂起（表明进程正在等待某一个事件发生且在外存中）
	- 挂起（等待,阻塞）进程在操作系统中可以定义为暂时被淘汰出内存的进程，机器的资源是有限的，在资源不足的情况下，操作系统对在内存中的程序进行合理的安排，其中有的进程被暂时调离出内存，当条件允许的时候，会被操作系统再次调回内存
	- 进入挂起状态的原因
		- 用户的请求：可能是在程序运行期间发现了可疑的问题，需要暂停进程
		- 父进程的请求：考察，协调，或修改子进程
		- 操作系统的需要：对运行中资源的使用情况进行检查和记账
		- 负载调节的需要：有一些实时的任务非常重要，需要得到充足的内存空间，这个时候我们需要把非实时的任务进行挂起，优先使得实时任务执行
		- 定时任务：一个进程可能会周期性的执行某个任务，那么在一次执行完毕后挂起而不是阻塞，这样可以节省内存
		- 安全：系统有时可能会出现故障或者某些功能受到破坏，这是就需要将系统中正在进行的进程进行挂起，当系统故障消除以后，对进程的状态进行恢复
- 终止

## 进程的控制结构
进程控制块（PCB）
### 定义
进程存在的唯一标识
### 结构
- 进程描述信息
	- 进程标识符
	- 用户标识符
- 状态信息
	- 进程状态
	- 优先级
- 资源分配清单
	- 地址空间
	- 打开的文件
- cpu相关信息
	- 寄存器的信息，以便进程重新执行时，能从断点处继续执行
### 组织方式
相同状态的进程链在一起，形成链表
- 将所有就绪状态的进程链在一起，形成就绪队列
- 等待某一事件的进程链在一起，形成阻塞队列

## 进程控制
- 创建进程
	- 分配一个唯一的进程标识号，并申请一个空白的pcb，pcb是有限的，申请失败则创建失败
	- 为进程分配资源，若资源不足则进程处于等待状态以等待资源
	- 初始化pcb
	- 如果进程的调度队列能够接纳新进程，则将其加入到就绪队列等待被调度

- 终止进程
	- 查找需要终止的进程的pcb
	- 如果处于执行状态，则立即终止进程执行，并将cpu资源分配给别的进程
	- 如果还有子进程，将所有子进程终止
	- 归还所用的全部资源给父进程或os
	- 将其从队列中删除

- 阻塞进程
	- 当某一进程需要等待某一事件完成时，它可以调用阻塞语句把自己阻塞等待。一旦被阻塞等待，只能由另一个进程唤醒
	- 找到将要阻塞的进程pcb
	- 如果为运行状态，保留现场，将其变为阻塞状态，停止运行
	- 将pcb插入到阻塞队列中

- 唤醒进程
	- 进程处于阻塞状态，是由于进程需要等待某一事件的完成，所以处于阻塞状态的进程是不能唤醒自己的
	- 在该事件的阻塞队列中找到相应的pcb
	- 将其从阻塞队列中移出，状态变更为就绪状态，插入到就绪队列